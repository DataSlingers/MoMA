context("Thresolding Tests")

test_that("Input validity test", {
    lambda <- 1
    gamma <- 3
    x <- seq(-4,4,0.01)
    # run those operators
    expect_error(prox_scad(x,lambda,1.99))
    expect_error(prox_scad(x,lambda,2),NA)
    expect_error(prox_mcp(x,lambda,0.999))
    expect_error(prox_mcp(x,lambda,1),NA)

})
test_that("When lambda=0, they should return exactly the input", {

    lambda <- 0
    gamma <- 3
    x <- seq(-4,4,0.01)
    # run those prox operators
    scadx <- prox_scad(x,lambda,3)
    mcpx <- prox_mcp(x,lambda,3)
    lassox <- prox_lasso(x,lambda)
    # tests
    expect_equal(norm(scadx - x),0)
    expect_equal(norm(mcpx - x),0)
    expect_equal(norm(lassox - x),0)

})

test_that("For NN-prox, when lambda=0, zero out negative entrie",{
    lambda <- 0
    gamma <- 3
    x.pos <- seq(0,4,0.05)
    x.neg <- seq(-4,0,0.05)
    # run those non-negative prox operators
    expect_equal(norm(prox_nnlasso(x.pos,lambda) - x.pos),0)
    expect_equal(norm(prox_nnlasso(x.neg,lambda)),0)
})

test_that("When lambda=3, they should behave properly", {
    lambda <- 1
    gamma <- 3
    x <- seq(-4,4,0.05)

    # goal setting lambda <- 1, gamma <- 3
    scad.goal <- c(-4.00,-3.95,-3.90,-3.85,-3.80,-3.75,-3.70,-3.65,-3.60,-3.55,-3.50,-3.45,-3.40,-3.35,-3.30,-3.25,-3.20,-3.15,-3.10,-3.05,-3.00,-2.90,-2.80,-2.70,-2.60,-2.50,-2.40,-2.30,-2.20,-2.10,-2.00,-1.90,-1.80,-1.70,-1.60,-1.50,-1.40,-1.30,-1.20,-1.10,-1.00,-0.95,-0.90,-0.85,-0.80,-0.75,-0.70,-0.65,-0.60,-0.55,-0.50,-0.45,-0.40,-0.35,-0.30,-0.25,-0.20,-0.15,-0.10,-0.05, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, 0.65, 0.70, 0.75, 0.80, 0.85, 0.90, 0.95, 1.00, 1.10, 1.20, 1.30, 1.40, 1.50, 1.60, 1.70, 1.80, 1.90, 2.00, 2.10, 2.20, 2.30, 2.40, 2.50, 2.60, 2.70, 2.80, 2.90, 3.00, 3.05, 3.10, 3.15, 3.20, 3.25, 3.30, 3.35, 3.40, 3.45, 3.50, 3.55, 3.60, 3.65, 3.70, 3.75, 3.80, 3.85, 3.90, 3.95, 4.00)
    mcp.goal <- c(-4.000,-3.950,-3.900,-3.850,-3.800,-3.750,-3.700,-3.650,-3.600,-3.550,-3.500,-3.450,-3.400,-3.350,-3.300,-3.250,-3.200,-3.150,-3.100,-3.050,-3.000,-2.925,-2.850,-2.775,-2.700,-2.625,-2.550,-2.475,-2.400,-2.325,-2.250,-2.175,-2.100,-2.025,-1.950,-1.875,-1.800,-1.725,-1.650,-1.575,-1.500,-1.425,-1.350,-1.275,-1.200,-1.125,-1.050,-0.975,-0.900,-0.825,-0.750,-0.675,-0.600,-0.525,-0.450,-0.375,-0.300,-0.225,-0.150,-0.075, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.000, 0.075, 0.150, 0.225, 0.300, 0.375, 0.450, 0.525, 0.600, 0.675, 0.750, 0.825, 0.900, 0.975, 1.050, 1.125, 1.200, 1.275, 1.350, 1.425, 1.500, 1.575, 1.650, 1.725, 1.800, 1.875, 1.950, 2.025, 2.100, 2.175, 2.250, 2.325, 2.400, 2.475, 2.550, 2.625, 2.700, 2.775, 2.850, 2.925, 3.000, 3.050, 3.100, 3.150, 3.200, 3.250, 3.300, 3.350, 3.400, 3.450, 3.500, 3.550, 3.600, 3.650, 3.700, 3.750, 3.800, 3.850, 3.900, 3.950, 4.000)
    lasso.goal <- c(-3.00,-2.95,-2.90,-2.85,-2.80,-2.75,-2.70,-2.65,-2.60,-2.55,-2.50,-2.45,-2.40,-2.35,-2.30,-2.25,-2.20,-2.15,-2.10,-2.05,-2.00,-1.95,-1.90,-1.85,-1.80,-1.75,-1.70,-1.65,-1.60,-1.55,-1.50,-1.45,-1.40,-1.35,-1.30,-1.25,-1.20,-1.15,-1.10,-1.05,-1.00,-0.95,-0.90,-0.85,-0.80,-0.75,-0.70,-0.65,-0.60,-0.55,-0.50,-0.45,-0.40,-0.35,-0.30,-0.25,-0.20,-0.15,-0.10,-0.05, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.05, 0.10, 0.15, 0.20, 0.25, 0.30, 0.35, 0.40, 0.45, 0.50, 0.55, 0.60, 0.65, 0.70, 0.75, 0.80, 0.85, 0.90, 0.95, 1.00, 1.05, 1.10, 1.15, 1.20, 1.25, 1.30, 1.35, 1.40, 1.45, 1.50, 1.55, 1.60, 1.65, 1.70, 1.75, 1.80, 1.85, 1.90, 1.95, 2.00, 2.05, 2.10, 2.15, 2.20, 2.25, 2.30, 2.35, 2.40, 2.45, 2.50, 2.55, 2.60, 2.65, 2.70, 2.75, 2.80, 2.85, 2.90, 2.95, 3.00)

    # run those operators
    scadx <- prox_scad(x,lambda,3)
    mcpx <- prox_mcp(x,lambda,3)
    lassox <- prox_lasso(x,lambda)

    expect_equal(norm(mcpx - mcp.goal),0)
    expect_equal(norm(lassox - lasso.goal),0)
    expect_equal(norm(scadx - scad.goal),0)

})

